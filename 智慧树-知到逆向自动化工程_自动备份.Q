[General]
SyntaxVersion=2
BeginHotkey=121
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=14c627c2-cbd5-4ee2-9770-0045a73dbd6e
Description=智慧树-知到逆向自动化工程_自动备份
Enable=1
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=Form1
[Relative]
SetupOCXFile=
[Comment]

[UIPackage]
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


[Script]

Function Initiate
    TracePrint "Starting MuMu..."
    RunApp "D:\工程\MuMu Player 12\shell\MuMuPlayer.exe"
    Delay 20000 ' 等待10秒，确保MuMu模拟器完全启动
    TracePrint "MuMu should be running now."
    Do
        HwndIni = Plugin.Window.Find("Qt5156QWindowIcon", "MuMu模拟器12")
        HwndIni1 = Plugin.Window.FindEx(HwndIni, 0, "Qt5156QWindowIcon", "MuMuPlayer")
        TracePrint HwndIni1
    Loop Until HwndIni1 <> 0
    Delay 8000
//    MsgBox "MuMu should be running now."
End Function 

//Call Initiate
Dim HD1,HD2,HD3//定义全局句柄
Sub Handle
    Dim Hwnd, HwndEx1, HwndEx2
    Hwnd = Plugin.Window.Find("Qt5156QWindowIcon", "MuMu模拟器12")
    HD1 = Hwnd
    HwndEx1 = Plugin.Window.FindEx(Hwnd, 0, "Qt5156QWindowIcon", "MuMuPlayer")
    HD2 = HwndEx1
    HwndEx2 = Plugin.Window.FindEx(HwndEx1, 0, "nemuwin", "nemudisplay")
    HD3 = HwndEx2
    //	MsgBox HD1
    //	MsgBox HD2
    //	MsgBox HD3
    //改变窗口大小为(1920, 1080)
End Sub
Sub HP
    Call Plugin.Window.Size(HD1, 2560, 1440)
End Sub
//
//
Event Form1.Button1.Click
Call Initiate
Call Handle
Call HP


//

//
//Goto nnn
//Call 初始化
//Goto Q
//
//HD1 = Hwnd
Do
    XY0 = Plugin.Bkgnd.FindColor(HD1, 255, 486, 290, 501, "FFA300")
    ZB0 = InStr(XY0, "|")
    X0 = Clng(Left(XY0, ZB0 - 1)) : Y0 = Clng(Right(XY0, Len(XY0) - ZB0))
    TracePrint X0
    TracePrint Y0
Loop Until X0 <> - 1  
//MsgBox "check"
	
Delay 1000
Do
    XY = Plugin.Bkgnd.FindColor(HD1, 198, 771, 1801, 1128, "0051FF")
    ZB = InStr(XY, "|")
    X = Clng(Left(XY, ZB - 1)): Y = Clng(Right(XY, Len(XY) - ZB))
    TracePrint X
    TracePrint Y
Loop Until X <> - 1 

//MsgBox "find"

Delay 1000
//Call Plugin.Bkgnd.LeftClick(HD2,482, 675)//点击图标
Call Plugin.Bkgnd.LeftClick(HD2, X, Y-251)//点击图标


Delay 5000
//MsgBox "doen"
Do
    //XY1 = Plugin.Bkgnd.FindPic(HD1, x1, y1, x2, y2, "D:\工程\项目图片\智慧树\进入检测.bmp", 0, 0.6)
    //iZB1 = InStr(XY1, "|")
    //X1 = CLng(Left(XY1, iZB1 - 1))
    //Y1 = CLng(Right(XY1, Len(XY1) - iZB1))
    GetColor = Plugin.Bkgnd.GetPixelColor(HD1, 1870, 311)
    //MsgBox  GetColor
Loop Until GetColor = "2E2D2A"
//MsgBox "Login"

Delay 3000
Call Plugin.Bkgnd.LeftClick(HD2, 227, 122)//点击学习
Delay 3000

Do
    GetColor1 = Plugin.Bkgnd.GetPixelColor(HD1, 303, 832)
Loop Until GetColor1 = "43CAFD"
Call Plugin.Bkgnd.LeftClick(HD2, 137, 606)//点击按键


Delay 5000
//检测是否弹窗
XY2 = Plugin.Bkgnd.FindColor(HD1, 1108, 291, 1856, 448, "79DE69")
ZB2 = InStr(XY2, "|")
X2 = Clng(Left(XY2, ZB2 - 1)) : Y2 = Clng(Right(XY2, Len(XY2) - ZB2))
If X2 <> - 1  Then 
    Delay 2000
    Call Plugin.Bkgnd.LeftClick(HD2, 983, 944)//点击下次再说
    //	Call Plugin.Bkgnd.LeftClick(HD2, 964, 864)//点击不再显示
    Delay 1000
Else 
//    Call Plugin.Bkgnd.LeftClick(HD2, 983, 944)//点击下次再说
End If
//MsgBox "Screenshut"
Delay 3000


//找箭头
Rem Rearr
XY3 = Plugin.Bkgnd.FindColorEx(HD1, 23, 233, 67, 291, "FDFDFC",0,0.9)
ZB3 = InStr(XY3, "|")
X3 = Clng(Left(XY3, ZB3 - 1)) : Y3 = Clng(Right(XY3, Len(XY3) - ZB3))
If X3 <> - 1  Then 
    Delay 400
    Call Plugin.Bkgnd.LeftClick(HD2, 38, 57)//点击下箭头
Else 
    Goto Rearr
End If
//
Delay 2000
/////////////////////////////////////////////////////////////
Rem nnn
//MsgBox "初始化开始"
Call 初始化




//统一大小
Delay 1000
//Call 平滑移动鼠标to(323, 1174, 1000, 328, 451, 0.9)
//
//智慧树下班阶
//
//Call Plugin.Bkgnd.LeftClick(HD2, 365, 269)//点击安全区
//Delay 1000
//Call 平滑移动鼠标to(563, 1169, 1000, 670, 1151, 0.9)//把AI拖走
//
//Delay 1000
//Call 平滑移动鼠标to(563, 1169, 1000, 670, 1153, 0.9)//把AI拖走
//Delay 1000
//Call Plugin.Bkgnd.LeftClick(HD2, 26, 473)//点击展开箭头1
//
//拖动AI
Call Plugin.Bkgnd.LeftDown(HD2, 694, 1151)
Delay 1000
Call Plugin.Bkgnd.MoveTo(HD2, 485, 1140)
Call Plugin.Bkgnd.LeftUp(HD2, 485, 1140)
//
Dim g
g = 0
Do
	
    Select Case g//遍历章节
    Case 0
        Call Plugin.Bkgnd.LeftClick(HD2, 26, 473)//点击展开箭头1
        //		MsgBox "call"
        Delay 1000
    Case 1
        Call Plugin.Bkgnd.LeftClick(HD2, 30, 547)//点击展开箭头2
        Delay 1000
    Case 2
        Call Plugin.Bkgnd.LeftClick(HD2, 26, 621)//点击展开箭头3
        Delay 1000
    Case 3
        Call Plugin.Bkgnd.LeftClick(HD2, 26, 694)//点击展开箭头4
        Delay 1000
    End Select
    //MsgBox "din1"

    Dim j//每一章都会初始化拖动次数
    j = 0
    TracePrint g

    Do

        Do
            XYB = Plugin.Bkgnd.FindPic(HD1, 568,667,736,1425, "D:\工程\项目图片\智慧树\可播放.bmp", 0, 0.5)
            iZBB = InStr(XYB, "|")
            XB = CLng(Left(XYB, iZBB - 1))
            YB = CLng(Right(XYB, Len(XYB) - iZBB))
            If XB <> -1 Then 
                TracePrint XB
                TracePrint YB
                Call Plugin.Bkgnd.LeftClick(HD2, XB+7,YB-52)//点击记忆隙间
//                MessageBox "kkk"
                Delay 1000
                Call 视频浏览
                Delay 1000
            Else 
                //		MsgBox "NOfound"
                TracePrint g
            End If
            Delay 1000
        Loop Until XB = - 1 //这一拖动层没有可播放的
        //向下拖动一页
        //	MsgBox "edlop"
        TracePrint g
        Call 滑动(0, 367, 1149, 381, 567, 1000)
        TracePrint g
        j = j + 1
        Delay 1000
    Loop Until j = 2
    TracePrint g
    //回溯初始化
    For 2
        Call 滑动(0, 381, 567, 367, 1149, 1000)
        Delay 300
    Next
    TracePrint g
    //
    Delay 1000

    Select Case g//返回章节选择
    Case 0
        Delay 1000
        Call Plugin.Bkgnd.LeftClick(HD2, 30, 473)//点击展开箭头1
        Delay 1000
    Case 1
        Delay 1000
        Call Plugin.Bkgnd.LeftClick(HD2, 30, 546)//点击展开箭头2
        Delay 1000
    Case 2
        Delay 1000
        Call Plugin.Bkgnd.LeftClick(HD2, 30, 620)//点击展开箭头2
        Delay 1000
    Case 3
        Delay 1000
        Call Plugin.Bkgnd.LeftClick(HD2, 30, 693)//点击展开箭头2
        Delay 1000
    End Select

    Delay 1000
    g = g + 1

Loop Until g = 4
MsgBox "exit"
//四个章节都没有
//去下一个课程
Call Plugin.Bkgnd.LeftClick(HD2, 19, 25)//点击退出箭头
Delay 2000
Do
    GetColor4 = Plugin.Bkgnd.GetPixelColor(HD1, 201, 606)
Loop Until GetColor4 = "3DC9FD"
Call Plugin.Bkgnd.LeftClick(HD2, 91, 592)//点击第二课程

End Event

Function 视频浏览
//    MsgBox "iii"
    Delay 1000
    Call Plugin.Bkgnd.LeftClick(HD2, 715, 224)//点击扩大界面
    Delay 1000
    //	Call Plugin.Bkgnd.LeftClick(HD2, 715, 224)//点击扩大界面


    Call Handle
//    Call HP

	
    //	Call Plugin.Bkgnd.LeftClick(HD2, 54, 1038)//点击播放
    Delay 800
    Call Plugin.Bkgnd.LeftClick(HD2, 1645, 1045)//点击1.26倍速
    Delay 300
    Call Plugin.Bkgnd.LeftClick(HD2, 1645, 1045)//点击1.5倍速
    Delay 300
	
    //第二遍可能变道1.25倍速
    XY倍速 = Plugin.Bkgnd.FindColorEx(HD1, 1570, 1236, 1579, 1245, "F6F7F8", 0, 0.7)
    ZB倍速 = InStr(XY倍速, "|")
    X倍速 = Clng(Left(XY倍速, ZB倍速 - 1)): Y倍速 = Clng(Right(XY倍速, Len(XY倍速) - ZB倍速))
    If X倍速 = - 1  Then //1.25被
//        MsgBox "1.5X"
        Call Plugin.Bkgnd.LeftClick(HD2, 1645, 1045)//点击1.5倍速
    End If
	
    Delay 800
    Call Plugin.Bkgnd.LeftClick(HD2, 43, 45)//点击返回
    Delay 3000
    // 竖屏调用
    Call Handle

	
	

    Delay 500
    Do
        //做大检测
        GetColor2 = Plugin.Bkgnd.GetPixelColor(HD1, 141, 343)
        TracePrint GetColor2
        If GetColor2 = "FBF8F5" Then //出现问题
//            MsgBox "er"
			Delay 1000
            Call 作答
        ELse
        End If
		
        GetColor3 = Plugin.Bkgnd.GetPixelColor(HD1, 370, 134)
        TracePrint GetColor3
    Loop Until GetColor3 = "8FACD9"
	
    Call Plugin.Bkgnd.LeftClick(HD2, 396, 137)//点击屏幕
    Delay 400
    Call Plugin.Bkgnd.LeftClick(HD2, 1645, 1045)//点击暂停
    Delay 2000
//    MsgBox "over"
End Function

Function 作答
    Delay 1000
    Call Plugin.Bkgnd.LeftClick(HD2, 190, 314)//点击A
    Delay 1000
    Call Plugin.Bkgnd.LeftClick(HD2, 660, 172)//点击叉
    Delay 800
End Function

Function 平滑移动鼠标to(终点坐标px, 终点坐标py, 移动时间, 起点坐标beginx, 起点坐标beginy, 平滑灵敏度)
    //Call Plugin.Bkgnd.LeftClick(HD2, 起点坐标beginx, 起点坐标beginy)//点击记忆隙间
    Call Plugin.Bkgnd.LeftDown(HD2, 起点坐标beginx, 起点坐标beginy)
    //Delay 800
    dim mx
    dim x,y
    dim tx,ty
    x=起点坐标beginx
    y=起点坐标beginy
    tx=abs(x-终点坐标px)


    ty=abs(y-终点坐标py)
    if tx>=ty
        mx=tx
    else
        mx=ty
    end if
    if mx>0
        for i = 0 to mx step 平滑灵敏度
            sx=int((终点坐标px*i+x*(mx-i))/mx)
            sy=int((终点坐标py*i+y*(mx-i))/mx)
            Call Plugin.Bkgnd.MoveTo(HD2, sx, sy)
            delay int(移动时间/mx*平滑灵敏度)
        Next
    else
        delay 移动时间
    end if
    Call Plugin.Bkgnd.MoveTo(HD2,终点坐标px, 终点坐标py)
    平滑移动鼠标to = true
    Call Plugin.Bkgnd.LeftUp(HD2, 终点坐标beginx, 终点坐标beginy)
    Delay 800
End Function

//Call 滑动(0, 367, 1149, 754, 266, 867)
Function 滑动(Code, X1, Y1, X2, Y2, S)
X1 = X1 + 150: Y1 = Y1 +150: X2 = X2 + 150: Y2 = Y2 +150
命令 = "shell input swipe " & X1 & " " & Y1 & " " & X2 & " " & Y2 & " " & S
命令 = """" & 命令 & """"
TracePrint 命令
路径 = "D:&&CD D:\工程\MuMu Player 12\shell"
命令行 = 路径&"&&MuMuManager.exe adb -v " &Code& " -c " &命令
TracePrint 命令行
Plugin.SMWH.GetDOS 命令行
End Function

Sub 初始化


    Delay 1000
//    MsgBox "wait"
    XYt0 = Plugin.Bkgnd.FindPic(HD1, 9,490,63,600, "D:\工程\项目图片\智慧树\未初始化Q1.bmp", 0, 0.6)
    iZBt0 = InStr(XYt0, "|")
    Xt0 = CLng(Left(XYt0, iZBt0 - 1))
    Yt0 = CLng(Right(XYt0, Len(XYt0) - iZBt0))
    If Xt0 <> - 1  Then 
        TracePrint Xt0
        TracePrint Yt0
//        	MsgBox "wait"
        	Call Plugin.Bkgnd.LeftClick(HD2, 31,469)//点击收起箭头
        Delay 1000
    Else 
//        MsgBox "nofoundQ1"
    End If

    Delay 1000

    XYt = Plugin.Bkgnd.FindPic(HD1, 9,490,63,868, "D:\工程\项目图片\智慧树\未初始化Q2.bmp", 0, 0.6)
    iZBt = InStr(XYt, "|")
    Xt = CLng(Left(XYt, iZBt - 1))
    Yt = CLng(Right(XYt, Len(XYt) - iZBt))
    //XY = Plugin.Bkgnd.FindColor(HD1, 0, 0, 1024, 768, "797764")
    //ZB = InStr(XY, "|")
    //X = Clng(Left(XY, ZB - 1)): Y = Clng(Right(XY, Len(XY) - ZB))

    If Xt <> - 1  Then //有
        TracePrint Xt 
        TracePrint Yt
        Call Plugin.Bkgnd.LeftClick(HD2, 30,547)//点击收起箭头
        Delay 1000
    Else 
//        MsgBox "nofoundQ2"
    End If

    Delay 1000
l
    XYt1 = Plugin.Bkgnd.FindPic(HD1, 9,490,63,868, "D:\工程\项目图片\智慧树\未初始化Q3.bmp", 0, 0.6)
    iZBt1 = InStr(XYt1, "|")
    Xt1 = CLng(Left(XYt1, iZBt1 - 1))
    Yt1 = CLng(Right(XYt1, Len(XYt1) - iZBt1))
    If Xt1 <> - 1  Then 
        TracePrint Xt1
        TracePrint Yt1
        Call Plugin.Bkgnd.LeftClick(HD2, 31,618)//点击收起箭头
        Delay 1000
    Else 
//        MsgBox "nofoundQ3"
    End If

    Delay 1000

    XYt2 = Plugin.Bkgnd.FindPic(HD1, 9,490,63,868, "D:\工程\项目图片\智慧树\未初始化Q4.bmp", 0, 0.6)
    iZBt2 = InStr(XYt2, "|")
    Xt2 = CLng(Left(XYt2, iZBt2 - 1))
    Yt2 = CLng(Right(XYt2, Len(XYt2) - iZBt2))
    If Xt2 <> - 1  Then 
        TracePrint Xt2
        TracePrint Yt2
        Call Plugin.Bkgnd.LeftClick(HD2, 31,693)//点击收起箭头
        Delay 1000
    Else 
//        MsgBox "nofoundQ4"
    End If
End Sub
